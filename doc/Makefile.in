INSTALL      = @INSTALL@
INSTALL_DATA = @INSTALL_DATA@
prefix       = @prefix@
infodir      = @infodir@
MAKEINFO     = @MAKEINFO@
EMACS        = @EMACS@
ADDITIONAL_LOAD_PATH = @ADDITIONAL_LOAD_PATH@
FLAGS = -q -no-site-file -batch -l w3mhack.el $(ADDITIONAL_LOAD_PATH)
EMACSINFO    = cd .. && $(EMACS) $(FLAGS) -f w3mhack-makeinfo

SHELL        = /bin/sh

INFO_DEPS    = emacs-w3m.info
INFO_DEPS_JA = emacs-w3m-ja.info

default: $(INFO_DEPS)

ja: $(INFO_DEPS_JA)

emacs-w3m.info: emacs-w3m.texi

emacs-w3m-ja.info: emacs-w3m-ja.texi

%.info: %.texi
	@texi=$<;\
	if test "$(MAKEINFO)" = "no" -o "$$texi" = "emacs-w3m-ja.texi"; then\
	  rm -f $@;\
	  $(EMACSINFO) $$texi;\
	else\
	  echo "Formatting $$texi using $(MAKEINFO)...";\
	  $(MAKEINFO) -o $@ $$texi;\
	  echo "Formatting $$texi using $(MAKEINFO)...done";\
	fi

%-ja.info: %-ja.texi
	@rm -f $@;\
	$(EMACSINFO) $<

install: $(INFO_DEPS)
	$(SHELL) ../mkinstalldirs $(infodir)
	@list='$(INFO_DEPS)';\
	for file in $$list; do\
	  for ifile in `echo $$file $$file-[0-9] $$file-[0-9][0-9]`; do\
	    if test -f $$ifile; then\
	      echo " $(INSTALL_DATA) $$ifile $(infodir)/$$ifile";\
	      $(INSTALL_DATA) $$ifile $(infodir)/$$ifile;\
	    else : ; fi;\
	  done;\
	done
	@if $(SHELL) -c 'install-info --version| sed 1q\
		| fgrep -s -v -i debian'>/dev/null 2>&1; then\
	  list='$(INFO_DEPS)';\
	  for file in $$list; do\
	    echo " install-info --info-dir=$(infodir) $(infodir)/$$file";\
	    install-info --info-dir=$(infodir) $(infodir)/$$file || :;\
	  done;\
	else : ; fi

install-ja: $(INFO_DEPS_JA)
	$(MAKE) INFO_DEPS='$(INFO_DEPS_JA)' EMACS="$(EMACS)"\
		infodir="$(infodir)" install

clean: -rm -rf *~ *.info *.info-[0-9] *.info-[0-9][0-9]

distclean: clean
	-rm -f Makefile
