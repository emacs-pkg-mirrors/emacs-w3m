INSTALL      = @INSTALL@
INSTALL_DATA = @INSTALL_DATA@
prefix       = @prefix@
lispdir      = @lispdir@
PACKAGEDIR   = @PACKAGEDIR@
ICONDIR      = @ICONDIR@
ADDITIONAL_LOAD_PATH = @ADDITIONAL_LOAD_PATH@

SHELL        = /bin/sh

@SET_MAKE@
EMACS   = @EMACS@
FLAGS   = -q -no-site-file -batch -l w3mhack.el $(ADDITIONAL_LOAD_PATH)
ECC     = $(EMACS) $(FLAGS) -f batch-byte-compile

MODULES = $(EMACS) $(FLAGS) -f w3mhack-examine-modules

PACKAGE = w3m_el
TARBALL = $(PACKAGE)-$(VERSION).tar.gz
DISTDIR = $(PACKAGE)-$(VERSION)
DOCS    = COPYING ChangeLog README README.ja TIPS.ja
DISTS   = Makefile Makefile.in aclocal.m4 configure configure.in install-sh mkinstalldirs


default:
	$(EMACS) $(FLAGS) -f w3mhack-compile

install: default
	@$(SHELL) ./mkinstalldirs $(lispdir);\
	for p in ChangeLog *.el; do\
	  echo " $(INSTALL_DATA) $$p $(lispdir)/$$p";\
	  $(INSTALL_DATA) $$p $(lispdir)/$$p;\
	done;\
	for p in *.elc; do\
	  echo " $(INSTALL_DATA) $$p $(lispdir)/$$p";\
	  $(INSTALL_DATA) $$p $(lispdir)/$$p;\
	done

install-icons:
	@if test $(ICONDIR) = NONE; then\
	  echo "You don't have to install icon files for \"$(EMACS)\".";\
	else\
	  $(SHELL) ./mkinstalldirs $(ICONDIR);\
	  cd icons;\
	  for i in *.xpm; do\
	    echo " $(INSTALL_DATA) $$i $(ICONDIR)/$$i";\
	    $(INSTALL_DATA) $$i $(ICONDIR)/$$i;\
	  done;\
	fi

install-package:
	@if test $(PACKAGEDIR) = NONE; then\
	  echo "What a pity!  Your \"$(EMACS)\" does not support"\
		"a package system.";\
	else\
	  $(MAKE) lispdir="$(PACKAGEDIR)/lisp/w3m" install;\
	  $(MAKE) ICONDIR="$(PACKAGEDIR)/etc/w3m" install-icons;\
	  echo "$(EMACS) $(FLAGS) -f w3mhack-make-package $(PACKAGEDIR)";\
	  $(EMACS) $(FLAGS) -f w3mhack-make-package $(PACKAGEDIR);\
	fi

dist:
	autoconf
	./configure
	$(MAKE) VERSION=`$(EMACS) $(FLAGS) -f w3mhack-version 2>/dev/null` tarball

tarball:
	-rm -f $(TARBALL) `basename $(TARBALL) .gz`
	mkdir $(DISTDIR)
	cp -p $(DOCS) $(DISTS) *.el $(DISTDIR)
	mkdir $(DISTDIR)/icons
	cp -p icons/*.xpm $(DISTDIR)/icons
	tar -cf `basename $(TARBALL) .gz` $(DISTDIR)
	gzip -9 `basename $(TARBALL) .gz`
	rm -rf $(DISTDIR)

clean:
	-rm -rf *~ *.elc $(PACKAGE)*

distclean: clean
	-rm -f configure config.log config.status config.cache Makefile
