prefix  = @prefix@
lispdir = @lispdir@
INSTALL = @INSTALL@
INSTALL_DATA = @INSTALL_DATA@
ADDITIONAL_LOAD_PATH = @ADDITIONAL_LOAD_PATH@

@SET_MAKE@
EMACS   = @EMACS@
FLAGS   = -q -no-site-file -batch -l w3mhack.el $(ADDITIONAL_LOAD_PATH)
ECC     = $(EMACS) $(FLAGS) -f batch-byte-compile

MODULES = `$(EMACS) $(FLAGS) -f w3mhack-examine-modules 2>/dev/null`

PACKAGE = w3m_el
TARBALL = $(PACKAGE)-$(VERSION).tar.gz
DISTDIR = $(PACKAGE)-$(VERSION)
DOCS    = COPYING ChangeLog README README.ja

.SUFFIXES:
.SUFFIXES: .elc .el

default:
	@modules="$(MODULES)"; echo "$(MAKE) $$modules"; $(MAKE) $$modules

.el.elc:
	$(ECC) $<

install: default
	@for p in ChangeLog *.el; do\
	  echo " $(INSTALL_DATA) $$p $(lispdir)/$$p";\
	  $(INSTALL_DATA) $$p $(lispdir)/$$p;\
	done
	@for p in *.elc; do\
	  echo " $(INSTALL_DATA) $$p $(lispdir)/$$p";\
	  $(INSTALL_DATA) $$p $(lispdir)/$$p;\
	done

dist:
	$(MAKE) VERSION=`$(EMACS) $(FLAGS) -f w3mhack-version 2>/dev/null` tarball

tarball:
	-rm -f $(TARBALL) `basename $(TARBALL) .gz`
	mkdir $(DISTDIR)
	cp -p $(DOCS) *.el $(DISTDIR)
	tar -cf `basename $(TARBALL) .gz` $(DISTDIR)
	gzip -9 `basename $(TARBALL) .gz`
	rm -rf $(DISTDIR)

clean:
	-rm -rf *~ *.elc $(PACKAGE)*

distclean: clean
	-rm -f configure config.log config.status config.cache Makefile
